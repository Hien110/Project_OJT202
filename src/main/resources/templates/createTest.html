<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo bài kiểm tra</title>
    <script src="/assets/js/headerNav.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/headerNav.css}" />
</head>

<body>
    <div th:insert="~{headerNav :: header}"></div>
    <div th:if="${session.account.accountRole == 'student'}" th:insert="~{headerNav :: navStudent}"></div>
    <div th:if="${session.account.accountRole == 'lecture'}" th:insert="~{headerNav :: navLecture}"></div>
    <div th:if="${session.account.accountRole == 'admin'}" th:insert="~{headerNav :: navAdmin}"></div>
    <form action="submitTest" method="POST" th:object="${test}"
        class="flex flex-col items-center bg-gray-100 pt-20 pl-20 rounded-lg shadow-md"
        onsubmit="return combineDateTime();" enctype="multipart/form-data">

        <!-- Chọn lớp -->
        <label for="classSelect">Chọn lớp:</label>
        <select id="classSelect" th:field="*{uniClass}" class="w-3/5 p-2 border rounded" required>
            <option value="">Chọn lớp</option>
            <option th:each="uniClass : ${uniClasses}" th:value="${uniClass.uniClassId}"
                th:text="${uniClass.uniClassName}"></option>
        </select>

        <!-- Chọn bài kiểm tra -->
        <label for="testSelect">Chọn bài kiểm tra:</label>
        <select id="testSelect" th:field="*{scoreTranscript}" class="w-3/5 p-2 border rounded">
            <option value="">Chọn bài kiểm tra</option>
            <option th:each="scoreTranscript : ${scoreTranscripts}" th:value="${scoreTranscript.scoreTranscriptID}"
                th:text="${scoreTranscript.nameTest}"></option>
        </select>

        <!-- Số lượng câu hỏi -->
        <div>
            <label for="questionCount" id="questionCount">Số lượng câu hỏi:</label>
            <input type="number" min="1" max="60" th:field="*{questionNumber}" class="p-2 border rounded"
                placeholder="Nhập số câu" oninput="validateInput()">
        </div>

        <!-- Câu khó, câu trung bình, câu dễ -->
        <div>
            <label for="hard">Câu khó:</label>
            <input type="number" min="1" max="60" th:field="*{hardQuestion}" id="hard" class="p-2 border rounded">
            <label for="medium">Câu trung bình:</label>
            <input type="number" min="1" max="60" th:field="*{mediumQuestion}" id="medium" class="p-2 border rounded">
            <label for="easy">Câu dễ:</label>
            <input type="number" min="1" max="60" th:field="*{easyQuestion}" id="easy" class="p-2 border rounded">
        </div>

        <!-- Thời gian bắt đầu -->
        <div>
            <label for="startExamDate">Thời gian bắt đầu:</label>
            <input type="date" id="startExamDate" class="w-full p-2 border rounded" required>
            <input type="time" id="startExamTime" class="w-full p-2 border rounded" required>
        </div>

        <!-- Thời gian kết thúc -->
        <div>
            <label for="endExamDate">Thời gian kết thúc:</label>
            <input type="date" id="endExamDate" class="w-full p-2 border rounded" required>
            <input type="time" id="endExamTime" class="w-full p-2 border rounded" required>
        </div>

        <!-- Trường ẩn để lưu thời gian bắt đầu và kết thúc -->
        <input type="hidden" th:field="*{testStartTime}" id="testStartTime">
        <input type="hidden" th:field="*{testFinishTime}" id="testFinishTime">

        <!-- Mức độ -->
        <div class="flex ">
            <label for="levelTest" class="pt-2">Mức độ:</label>
            <select name="levelTest" th:field="*{testLevel}" class="p-2 border rounded" id="levelTest">
                <option value="Dễ">Dễ</option>
                <option value="Trung Bình">Trung Bình</option>
                <option value="Khó">Khó</option>
            </select>
        </div>

        <div class="bg-gray-100 p-6 rounded-lg shadow-lg mt-4">
            <div class="flex space-x-4">

                <a class="tab px-4 py-2 rounded-md transition-all duration-300 
                  bg-gray-100 text-gray-700 hover:brightness-110 hover:text-blue-500 active" data-value="0"
                    onclick="setStatusTest(this)">
                    Ngân hàng câu hỏi
                </a>

                <a class="tab px-4 py-2 rounded-md transition-all duration-300 
                  bg-gray-100 text-gray-700 hover:brightness-110 hover:text-blue-500" data-value="1"
                    onclick="setStatusTest(this)">
                    Upload câu hỏi
                </a>

                <input type="hidden" id="statusTestInput" name="statusTest" th:field="*{statusTest}" value="">
            </div>

            <div id="uploadFileForm" style="display: none;" class="mt-4">
                <p class="text-gray-700">Upload gói câu hỏi tự chọn cho bài kiểm tra</p>
                <label for="fileUpload" class="block mb-2 text-gray-700">Tải lên tệp:</label>
                <input type="file" id="fileUpload" name="fileUpload" class="w-full p-2 border rounded mb-4">
                <a href="/assets/example/Questions.xlsx" class="hover:text-cyan-500"> Tải mẫu Question.xlsx</a>
            </div>

            <!-- Mật khẩu -->
            <div>
                <label for="passwordInput">Nhập mật khẩu:</label>
                <input type="password" th:field="*{testkeyWord}" id="passwordInput" class="p-2 border rounded">
                <input type="checkbox" onclick="togglePassword()"> Hiển thị mật khẩu
            </div>

            <button type="submit"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Tạo bài kiểm tra
            </button>
        </div>
    </form>

    <script>
        function togglePassword() {
            const passwordInput = document.getElementById("passwordInput");
            passwordInput.type = passwordInput.type === "password" ? "text" : "password";
        }

        function combineDateTime() {
            // Lấy giá trị của startExamDate và startExamTime
            const startDate = document.getElementById("startExamDate").value;
            const startTime = document.getElementById("startExamTime").value;

            if (startDate && startTime) {
                const testStartTime = `${startDate}T${startTime}`;
                document.getElementById("testStartTime").value = testStartTime;  // Cập nhật giá trị cho trường ẩn
                console.log("Thời gian bắt đầu (testStartTime):", testStartTime);
            } else {
                alert("Vui lòng chọn đầy đủ thời gian bắt đầu.");
                return false;
            }

            // Lấy giá trị của endExamDate và endExamTime
            const endDate = document.getElementById("endExamDate").value;
            const endTime = document.getElementById("endExamTime").value;

            if (endDate && endTime) {
                const testEndTime = `${endDate}T${endTime}`;
                document.getElementById("testFinishTime").value = testEndTime;  // Cập nhật giá trị cho trường ẩn
                console.log("Thời gian kết thúc (testFinishTime):", testEndTime);
            } else {
                alert("Vui lòng chọn đầy đủ thời gian kết thúc.");
                return false;
            }
            return true;  // Trả về true để gửi biểu mẫu
        }

        function validateInput() {
            const input = document.getElementById("questionCount");
            if (input.value > 60) {
                input.value = 60;
            } else if (input.value < 1) {
                input.value = 1;
            }
        }

        function toggleActive(selectedTab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('opacity-50', 'active'); // Loại bỏ các lớp mờ và active trên tất cả các thẻ
            });
            selectedTab.classList.add('active'); // Thêm lớp active vào thẻ được chọn
            tabs.forEach(tab => {
                if (!tab.classList.contains('active')) {
                    tab.classList.add('opacity-50'); // Thêm độ mờ cho các thẻ không được chọn
                }
            });
        }

        const tabs = document.querySelectorAll('.tab');

        // Gắn sự kiện click vào từng thẻ
        tabs.forEach((tab) => {
            tab.addEventListener('click', () => {
                // Xóa 'active' và các lớp style từ tất cả các tab
                tabs.forEach((t) => t.classList.remove('brightness-150', 'text-sky-400', 'opacity-50'));

                // Thêm các lớp style vào tab được chọn
                tab.classList.add('brightness-150', 'text-sky-400');

                // Truyền đúng formId vào showForm
                const formId = tab.textContent.trim() === 'Ngân hàng câu hỏi' ? '' : 'uploadFileForm';
                showForm(formId);
            });
        });


        function showForm(formId) {
            // Ẩn tất cả các form khi bắt đầu
            document.getElementById('uploadFileForm').style.display = 'none'; // Ẩn form Upload câu hỏi

            // Hiển thị form tương ứng với formId
            if (formId === 'uploadFileForm') {
                document.getElementById('uploadFileForm').style.display = 'block'; // Hiển thị form Upload câu hỏi
            } else {
                document.getElementById('uploadFileForm').style.display = 'none'; // Ẩn form Ngân hàng câu hỏi
            }
        }


        function setStatusTest(element) {
            // Lấy giá trị từ data-value của thẻ <a>
            const statusValue = element.getAttribute('data-value');

            // Cập nhật giá trị của input ẩn
            document.getElementById('statusTestInput').value = statusValue;
        }
    </script>
</body>

</html>