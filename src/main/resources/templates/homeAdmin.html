<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home Admin</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Notification Management</h1>
    
    <form id="notificationForm" enctype="multipart/form-data">
        <input type="hidden" id="notificationId" name="notificationId"/>
        <label>Name:</label>
        <input type="text" id="notificationName" name="notificationName" required/><br/>
        <label>Content:</label>
        <textarea id="notificationContent" name="notificationContent" required></textarea><br/>
        <label>File:</label>
        <input type="file" name="file"/><br/>
        <label>Image:</label>
        <input type="file" name="image"/><br/>
        <button type="button" id="saveButton">Create</button>
    </form>

    <h2>Notification List</h2>
    <table id="notificationTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Content</th>
                <th>File</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="notification : ${notifications}">
                <td th:text="${notification.notificationID}"></td>
                <td th:text="${notification.notificationName}"></td>
                <td th:text="${notification.notificationContent}"></td>
                <td th:text="${notification.notificationFile}"></td>
                <td th:text="${notification.notificationImage}"></td>
                <td>
                    <button class="editButton" data-id="${notification.notificationID}">Edit</button>
                    <button class="deleteButton" data-id="${notification.notificationID}">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // Load notifications
            loadNotifications();

            // Create or update notification
            $("#saveButton").click(function() {
                const id = $("#notificationId").val();
                const url = id ? `/homeAdmin/notifications/edit/${id}` : '/homeAdmin/notifications/create';
                const formData = new FormData($("#notificationForm")[0]);

                $.ajax({
                    type: id ? "POST" : "POST",
                    url: url,
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        if (response === "success") {
                            loadNotifications();
                            resetForm();
                        } else {
                            alert("Error occurred while saving.");
                        }
                    }
                });
            });

            // Edit notification
            $(document).on("click", ".editButton", function() {
                const id = $(this).data("id");
                $.get(`/homeAdmin/notifications/list`, function(notifications) {
                    const notification = notifications.find(n => n.notificationID === id);
                    if (notification) {
                        $("#notificationId").val(notification.notificationID);
                        $("#notificationName").val(notification.notificationName);
                        $("#notificationContent").val(notification.notificationContent);
                    }
                });
            });

            // Delete notification
            $(document).on("click", ".deleteButton", function() {
                const id = $(this).data("id");
                $.ajax({
                    type: "GET",
                    url: `/homeAdmin/notifications/delete/${id}`,
                    success: function(response) {
                        if (response === "success") {
                            loadNotifications();
                        } else {
                            alert("Error occurred while deleting.");
                        }
                    }
                });
            });
        });

        function loadNotifications() {
            $.get("/homeAdmin/notifications/list", function(notifications) {
                const rows = notifications.map(n => `
                    <tr>
                        <td>${n.notificationID}</td>
                        <td>${n.notificationName}</td>
                        <td>${n.notificationContent}</td>
                        <td>${n.notificationFile}</td>
                        <td>${n.notificationImage}</td>
                        <td>
                            <button class="editButton" data-id="${n.notificationID}">Edit</button>
                            <button class="deleteButton" data-id="${n.notificationID}">Delete</button>
                        </td>
                    </tr>
                `).join('');
                $("#notificationTable tbody").html(rows);
            });
        }

        function resetForm() {
            $("#notificationForm")[0].reset();
            $("#notificationId").val('');
        }
    </script>
</body>
</html>
